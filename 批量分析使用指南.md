# OFIå› å­ç ”ç©¶ - æ‰¹é‡åˆ†æä½¿ç”¨æŒ‡å—

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•ä½¿ç”¨æ‰¹é‡åˆ†æåŠŸèƒ½å¯¹å¤šä¸ªå“ç§å’Œå¤šä¸ªæ—¶é—´å‘¨æœŸè¿›è¡ŒOFIå› å­ç ”ç©¶ã€‚

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®å“ç§å’Œæ—¶é—´å‘¨æœŸ

ç¼–è¾‘ `config/settings.yaml`:

```yaml
# é€‰æ‹©è¦åˆ†æçš„å“ç§
symbols:
  - BTCUSD
  - ETHUSD
  - EURUSD
  - USDJPY
  - XAGUSD
  - XAUUSD

# é€‰æ‹©æ—¶é—´å‘¨æœŸ
bar_settings:
  bar_sizes:
    - "1H"   # 1å°æ—¶
    - "2H"   # 2å°æ—¶
    - "4H"   # 4å°æ—¶
    - "8H"   # 8å°æ—¶
    - "1D"   # 1å¤©

# æ•°æ®è¿‡æ»¤ï¼ˆå¯é€‰ï¼‰
data:
  start_date: "2020-01-01"  # å¼€å§‹æ—¥æœŸ
  end_date: null            # ç»“æŸæ—¥æœŸï¼ˆnull = æœ€æ–°ï¼‰
```

### 2. è¿è¡Œæ‰¹é‡åˆ†æ

```bash
# å®Œæ•´æ‰¹é‡åˆ†æï¼ˆæ‰€æœ‰å“ç§ Ã— æ‰€æœ‰å‘¨æœŸï¼‰
python scripts/run_batch_analysis.py

# æˆ–è€…å…ˆæµ‹è¯•å•ä¸ªå“ç§
python scripts/quick_batch_test.py  # ä»…BTCUSD
```

### 3. ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š

```bash
# ç”Ÿæˆæ±‡æ€»æŠ¥å‘Šå’Œç»Ÿè®¡
python scripts/generate_summary_report.py

# ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
python scripts/visualize_results.py
```

---

## ğŸ“ è¾“å‡ºæ–‡ä»¶ç»“æ„

```
results/
â”œâ”€â”€ BTCUSD_1H_bars_with_ofi.csv      # Kçº¿æ•°æ® + OFIå› å­
â”œâ”€â”€ BTCUSD_2H_bars_with_ofi.csv
â”œâ”€â”€ BTCUSD_4H_bars_with_ofi.csv
â”œâ”€â”€ ...
â”œâ”€â”€ sanity/
â”‚   â”œâ”€â”€ ofi_R0_sanity_BTCUSD_1H.md   # å¥å…¨æ€§æ£€æŸ¥æŠ¥å‘Š
â”‚   â”œâ”€â”€ ofi_R0_sanity_BTCUSD_2H.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ single_factor/
â”‚   â”œâ”€â”€ ofi_R1_single_factor_BTCUSD_1H.csv  # æ¡ä»¶æ”¶ç›Šåˆ†æ
â”‚   â”œâ”€â”€ ofi_R1_bins_BTCUSD_1H.csv           # åˆ†ä½æ•°åˆ†ç»„åˆ†æ
â”‚   â””â”€â”€ ...
â”œâ”€â”€ plots/
â”‚   â”œâ”€â”€ spread_by_symbol_horizon.png        # æ”¶ç›Šå·®å¼‚è¶‹åŠ¿å›¾
â”‚   â”œâ”€â”€ t_statistics_heatmap.png            # ç»Ÿè®¡æ˜¾è‘—æ€§çƒ­åŠ›å›¾
â”‚   â”œâ”€â”€ top20_configurations.png            # Top20é…ç½®æŸ±çŠ¶å›¾
â”‚   â””â”€â”€ spread_vs_tstat.png                 # æ•£ç‚¹å›¾
â”œâ”€â”€ OFI_FULL_SUMMARY.csv                    # å®Œæ•´æ±‡æ€»æ•°æ®
â””â”€â”€ OFI_ANALYSIS_SUMMARY.md                 # è¯¦ç»†åˆ†ææŠ¥å‘Š
```

---

## ğŸ“Š å¦‚ä½•è§£è¯»ç»“æœ

### 1. æŸ¥çœ‹æ±‡æ€»æŠ¥å‘Š

```bash
# Windows
notepad results\OFI_ANALYSIS_SUMMARY.md

# Linux/Mac
cat results/OFI_ANALYSIS_SUMMARY.md
```

æŠ¥å‘ŠåŒ…å«ï¼š
- **Top 20æœ€å¤§æ”¶ç›Šå·®å¼‚**: æ‰¾å‡ºæœ€æœ‰æ•ˆçš„é…ç½®
- **Top 20æœ€æ˜¾è‘—ç»Ÿè®¡ç»“æœ**: æ‰¾å‡ºæœ€å¯é çš„é…ç½®
- **å„å“ç§è¡¨ç°æ±‡æ€»**: æ¯ä¸ªå“ç§çš„æœ€ä½³é…ç½®

### 2. æŸ¥çœ‹å¯è§†åŒ–å›¾è¡¨

æ‰“å¼€ `results/plots/` ç›®å½•æŸ¥çœ‹å›¾è¡¨ï¼š

- **spread_by_symbol_horizon.png**: 
  - æ˜¾ç¤ºæ¯ä¸ªå“ç§åœ¨ä¸åŒæ—¶é—´å‘¨æœŸå’Œé¢„æµ‹è·¨åº¦ä¸‹çš„æ”¶ç›Šå·®å¼‚
  - å¸®åŠ©è¯†åˆ«æœ€ä½³æ—¶é—´å‘¨æœŸ

- **t_statistics_heatmap.png**:
  - çƒ­åŠ›å›¾æ˜¾ç¤ºç»Ÿè®¡æ˜¾è‘—æ€§
  - ç»¿è‰² = é«˜æ˜¾è‘—æ€§ï¼Œçº¢è‰² = ä½æ˜¾è‘—æ€§
  - å¸®åŠ©è¯„ä¼°ç»“æœå¯é æ€§

- **top20_configurations.png**:
  - æŸ±çŠ¶å›¾æ˜¾ç¤ºTop 20é…ç½®
  - æŒ‰å“ç§é¢œè‰²ç¼–ç 
  - å¿«é€Ÿè¯†åˆ«æœ€ä½³ç­–ç•¥

- **spread_vs_tstat.png**:
  - æ•£ç‚¹å›¾æ˜¾ç¤ºæ”¶ç›Šå·® vs ç»Ÿè®¡æ˜¾è‘—æ€§
  - å³ä¸Šè§’ = é«˜æ”¶ç›Š + é«˜æ˜¾è‘—æ€§ï¼ˆæœ€ä½³ï¼‰
  - å¸®åŠ©å¹³è¡¡æ”¶ç›Šå’Œå¯é æ€§

### 3. æŸ¥çœ‹è¯¦ç»†æ•°æ®

```python
import pandas as pd

# åŠ è½½å®Œæ•´æ±‡æ€»æ•°æ®
df = pd.read_csv('results/OFI_FULL_SUMMARY.csv')

# ç­›é€‰ç‰¹å®šå“ç§
btc_data = df[df['symbol'] == 'BTCUSD']

# ç­›é€‰é«˜æ˜¾è‘—æ€§é…ç½®ï¼ˆt > 3ï¼‰
significant = df[df['high_ofi_t_stat'] > 3]

# æŒ‰æ”¶ç›Šå·®æ’åº
top_spread = df.sort_values('spread', ascending=False).head(10)
```

---

## ğŸ¯ å®ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹1: æ‰¾å‡ºæœ€ä½³äº¤æ˜“é…ç½®

**ç›®æ ‡**: æ‰¾å‡ºæ”¶ç›Šæœ€é«˜ä¸”ç»Ÿè®¡æ˜¾è‘—çš„é…ç½®

```python
import pandas as pd

df = pd.read_csv('results/OFI_FULL_SUMMARY.csv')

# ç­›é€‰æ¡ä»¶ï¼š
# 1. tç»Ÿè®¡é‡ > 3 (ç»Ÿè®¡æ˜¾è‘—)
# 2. æ”¶ç›Šå·® > 0.2% (æœ‰å®é™…æ„ä¹‰)
# 3. æŒ‰æ”¶ç›Šå·®æ’åº

best_configs = df[
    (df['high_ofi_t_stat'] > 3) & 
    (df['spread'] > 0.002)
].sort_values('spread', ascending=False)

print(best_configs[['symbol', 'bar_size', 'horizon', 'spread', 'high_ofi_t_stat']].head(10))
```

**ç»“æœç¤ºä¾‹**:
```
   symbol bar_size  horizon    spread  high_ofi_t_stat
0  ETHUSD       1D       10  0.054540             5.62
1  ETHUSD       1D        5  0.024260             3.86
2  ETHUSD       1D        2  0.008780             3.54
3  ETHUSD       8H       10  0.004800             5.60
4  BTCUSD       4H       10  0.004140             4.99
```

### æ¡ˆä¾‹2: æ¯”è¾ƒä¸åŒå“ç§

**ç›®æ ‡**: æ¯”è¾ƒBTCå’ŒETHåœ¨ç›¸åŒé…ç½®ä¸‹çš„è¡¨ç°

```python
import pandas as pd

df = pd.read_csv('results/OFI_FULL_SUMMARY.csv')

# é€‰æ‹©8Hå‘¨æœŸï¼ŒHorizon=10
config = df[(df['bar_size'] == '8H') & (df['horizon'] == 10)]

# æ¯”è¾ƒBTCå’ŒETH
comparison = config[config['symbol'].isin(['BTCUSD', 'ETHUSD'])]
print(comparison[['symbol', 'spread', 'high_ofi_t_stat', 'ols_beta']])
```

### æ¡ˆä¾‹3: åˆ†ææ—¶é—´å‘¨æœŸå½±å“

**ç›®æ ‡**: å¯¹äºBTCUSDï¼Œæ‰¾å‡ºæœ€ä½³æ—¶é—´å‘¨æœŸ

```python
import pandas as pd
import matplotlib.pyplot as plt

df = pd.read_csv('results/OFI_FULL_SUMMARY.csv')

# ç­›é€‰BTCUSD
btc = df[df['symbol'] == 'BTCUSD']

# æŒ‰æ—¶é—´å‘¨æœŸåˆ†ç»„ï¼Œè®¡ç®—å¹³å‡æ”¶ç›Šå·®
by_period = btc.groupby('bar_size')['spread'].mean().sort_values(ascending=False)

print("BTCUSDå„æ—¶é—´å‘¨æœŸå¹³å‡æ”¶ç›Šå·®:")
print(by_period)

# å¯è§†åŒ–
by_period.plot(kind='bar', title='BTCUSD: Average Spread by Time Period')
plt.ylabel('Average Spread')
plt.tight_layout()
plt.savefig('btc_period_comparison.png')
```

---

## âš™ï¸ é«˜çº§é…ç½®

### è°ƒæ•´OFIå‚æ•°

ç¼–è¾‘ `config/settings.yaml`:

```yaml
ofi:
  zscore_window: 200  # OFIæ ‡å‡†åŒ–çª—å£ï¼ˆé»˜è®¤200ï¼‰
                      # å¢å¤§ = æ›´å¹³æ»‘ï¼Œå‡å° = æ›´æ•æ„Ÿ

analysis:
  horizons: [2, 5, 10]      # é¢„æµ‹æ—¶é—´è·¨åº¦
  quantile_low: 0.10        # ä½åˆ†ä½æ•°é˜ˆå€¼ï¼ˆé»˜è®¤10%ï¼‰
  quantile_high: 0.90       # é«˜åˆ†ä½æ•°é˜ˆå€¼ï¼ˆé»˜è®¤90%ï¼‰
  n_bins: 5                 # åˆ†ä½æ•°åˆ†ç»„æ•°é‡
```

### åªåˆ†æç‰¹å®šå“ç§

```yaml
symbols:
  - BTCUSD  # åªåˆ†æBTC
  # - ETHUSD
  # - EURUSD
```

### åªåˆ†æç‰¹å®šæ—¶é—´å‘¨æœŸ

```yaml
bar_settings:
  bar_sizes:
    - "4H"  # åªåˆ†æ4å°æ—¶å‘¨æœŸ
    # - "1H"
    # - "8H"
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: å†…å­˜ä¸è¶³

**ç—‡çŠ¶**: ç¨‹åºè¿è¡Œç¼“æ…¢æˆ–å´©æºƒ

**è§£å†³æ–¹æ¡ˆ**:
1. å‡å°‘å“ç§æ•°é‡ï¼ˆä¸€æ¬¡åªåˆ†æ1-2ä¸ªå“ç§ï¼‰
2. ç¼©çŸ­æ•°æ®èŒƒå›´ï¼ˆè®¾ç½®start_dateï¼‰
3. å‡å°‘æ—¶é—´å‘¨æœŸæ•°é‡

```yaml
data:
  start_date: "2023-01-01"  # åªåˆ†ææœ€è¿‘2å¹´
```

### é—®é¢˜2: æŸäº›å“ç§å¤±è´¥

**ç—‡çŠ¶**: éƒ¨åˆ†å“ç§åˆ†æå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ•°æ®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
3. å•ç‹¬è¿è¡Œå¤±è´¥çš„å“ç§è¿›è¡Œè°ƒè¯•

```bash
# å•ç‹¬æµ‹è¯•ETHUSD
python -c "
from src.data.parquet_tick_loader import load_partitioned_parquet_ticks
from pathlib import Path
ticks = load_partitioned_parquet_ticks('ETHUSD', Path('data/ticks'))
print(f'Loaded {len(ticks)} ticks')
"
```

### é—®é¢˜3: å›¾è¡¨æ— æ³•ç”Ÿæˆ

**ç—‡çŠ¶**: visualize_results.pyæŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿å·²å®‰è£…matplotlib: `pip install matplotlib`
2. ç¡®ä¿å·²è¿è¡Œgenerate_summary_report.py
3. æ£€æŸ¥results/OFI_FULL_SUMMARY.csvæ˜¯å¦å­˜åœ¨

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å¼€å§‹ä½¿ç”¨.md** - é¡¹ç›®å¿«é€Ÿå…¥é—¨
- **æ‰¹é‡åˆ†æå®ŒæˆæŠ¥å‘Š.md** - æœ€æ–°åˆ†æç»“æœæ€»ç»“
- **results/OFI_ANALYSIS_SUMMARY.md** - è¯¦ç»†åˆ†ææŠ¥å‘Š
- **docs/OFI_DESIGN_NOTES.md** - OFIå› å­ç†è®ºè®¾è®¡

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **é¦–æ¬¡è¿è¡Œ**: å…ˆç”¨quick_batch_test.pyæµ‹è¯•å•ä¸ªå“ç§
2. **æ•°æ®éªŒè¯**: æ£€æŸ¥ç”Ÿæˆçš„Kçº¿æ•°é‡æ˜¯å¦åˆç†
3. **ç»“æœéªŒè¯**: æŸ¥çœ‹tç»Ÿè®¡é‡ï¼Œç¡®ä¿ç»Ÿè®¡æ˜¾è‘—æ€§
4. **å‚æ•°è°ƒä¼˜**: å°è¯•ä¸åŒçš„zscore_windowå’Œhorizons
5. **å®šæœŸæ›´æ–°**: éšç€æ–°æ•°æ®åˆ°æ¥ï¼Œé‡æ–°è¿è¡Œåˆ†æ

---

**ç¥ç ”ç©¶é¡ºåˆ©ï¼** ğŸ‰

