# OFI因子研究项目 - 开始使用

## 🎉 项目已就绪

所有代码已完成并测试通过！您现在可以开始使用这个OFI（订单流失衡）因子研究系统。

---

## 📚 重要文档

在开始之前，建议您阅读以下文档：

1. **QUICKSTART.md** - 快速入门指南（5分钟上手）
2. **README.md** - 项目总览和详细说明
3. **COMPLETION_SUMMARY.md** - 完成总结和测试结果
4. **docs/OFI_DESIGN_NOTES.md** - OFI因子的理论基础

---

## ⚡ 快速开始（3步）

### 第1步：安装依赖
```bash
pip install -r requirements.txt
```

### 第2步：准备数据

**选项A - 使用示例数据（推荐用于测试）**
```bash
python scripts/generate_sample_data.py
```

**选项B - 使用您自己的数据**
1. 将tick数据CSV放入 `data/ticks/` 目录
2. 文件命名格式：`{SYMBOL}_ticks*.csv`
3. 编辑 `config/settings.yaml` 设置品种列表

### 第3步：运行分析
```bash
# 构建K线和OFI因子
python scripts/build_bars_with_ofi.py

# 运行单因子分析
python scripts/run_ofi_single_factor.py
```

---

## 📊 查看结果

分析完成后，结果保存在 `results/` 目录：

### 1. 健全性检查报告（Markdown格式）
```bash
type results\sanity\ofi_R0_sanity_BTCUSD.md
```

包含：
- OFI分布统计
- 关键分位数
- 相关性分析

### 2. 单因子分析（CSV格式）
```
results/single_factor/ofi_R1_single_factor_BTCUSD.csv
```

包含：
- 高/低OFI_z组的条件收益
- t统计量
- 回归分析结果

### 3. 分位数分析（CSV格式）
```
results/single_factor/ofi_R1_bins_BTCUSD.csv
```

包含：
- OFI_z分为5组
- 每组的平均收益

### 4. K线+OFI数据（CSV格式）
```
results/BTCUSD_4h_bars_with_ofi.csv
```

包含：
- OHLCV（开高低收量）
- OFI_raw（原始订单流失衡）
- OFI_z（标准化OFI）

---

## 🔧 配置参数

编辑 `config/settings.yaml` 可以调整：

```yaml
# 交易品种
symbols:
  - BTCUSD
  - XAUUSD

# K线周期（可改为 1H, 2H, 8H 等）
ofi:
  bar_size: "4H"
  zscore_window: 200

# 分析参数
analysis:
  horizons: [2, 5, 10]    # 未来收益时间跨度
  quantile_low: 0.10      # 低分位数阈值
  quantile_high: 0.90     # 高分位数阈值
```

---

## 📖 数据格式

Tick数据CSV支持两种格式：

**格式A - Bid/Ask（推荐）**
```csv
timestamp,bid,ask,volume
2024-01-01 00:00:00,42000.5,42001.0,1.5
```

**格式B - 单一价格**
```csv
timestamp,price,volume
2024-01-01 00:00:00,42000.75,1.5
```

详见：`data/DATA_FORMAT.md`

---

## 🎯 OFI因子说明

### 什么是OFI？

**订单流失衡（Order Flow Imbalance, OFI）** 衡量市场买卖压力的不平衡程度。

### OFI_raw
```
OFI_raw = (买方成交量 - 卖方成交量) / 总成交量
```

- 范围：-1 到 +1
- +1 = 全部买方主动
- -1 = 全部卖方主动
- 0 = 买卖平衡

### OFI_z
```
OFI_z = (OFI_raw - 滚动均值) / 滚动标准差
```

- 标准化的OFI，衡量相对于历史的极端程度
- |OFI_z| 越大，订单流越异常

### 研究问题

1. **波动性预测**：极端OFI_z是否预示更大的价格波动？
2. **方向性预测**：OFI_z的符号是否提供方向性优势？
3. **稳健性**：OFI模式在不同资产和时期是否稳健？

---

## 📁 项目结构

```
ofiproxy/
├── config/              # 配置文件
├── data/                # 数据目录
│   └── ticks/          # 放置tick数据的地方
├── results/            # 分析结果输出
├── docs/               # 文档
├── src/                # 源代码
│   ├── data/           # 数据处理
│   ├── factors/        # 因子计算
│   ├── research/       # 研究分析
│   └── utils/          # 工具函数
└── scripts/            # 可执行脚本
```

---

## 🛠️ 常见问题

### Q: 找不到tick数据文件
**A:** 确保文件在 `data/ticks/` 目录，文件名匹配 `{SYMBOL}_ticks*.csv` 格式

### Q: OFI_z全是NaN
**A:** 数据量不足。需要至少200个K线才能计算OFI_z。可以：
- 增加tick数据量
- 或减小 `zscore_window` 参数

### Q: 想分析1小时K线
**A:** 修改 `config/settings.yaml` 中的 `bar_size: "1H"`，然后重新运行脚本

---

## 🚀 下一步

1. **查看示例结果** - 项目已包含示例数据的分析结果
2. **使用真实数据** - 替换为您自己的tick数据
3. **调整参数** - 尝试不同的K线周期和分析参数
4. **扩展功能** - 添加新因子、新分析或回测功能

---

## 📞 获取帮助

- 查看 `QUICKSTART.md` 了解详细步骤
- 查看 `docs/OFI_DESIGN_NOTES.md` 了解理论基础
- 查看 `PROJECT_STRUCTURE.md` 了解代码结构
- 查看源代码中的docstring了解函数用法

---

**祝您研究顺利！** 🎊

